{"payload":{"meta":{"Graph":{"@Type":"81297157","@Value":{"Guid":"(Guid)3bc25518-2022-4768-a8c7-d2d021c7a0af","ParentGuid":"(Guid)fe54070b-3512-4a2f-b490-a57c15f4bfb5","Name":"(string)Output_block","Properties":{"@Type":"2c41fa04:IDictionary","@Value":[{"@Key":"(Guid)829a18f2-c514-4f6e-9634-1df173429203","@Value":{"@Type":"829a18f2","@Value":{"ParentObjects":{"@Type":"fa2ee218:IDictionary","@Value":[{"@Key":"(Guid)d9b2b2cc-ea99-4c3b-aa42-1e5c49e65b84","@Value":"(Guid)b274a875-2779-4ec5-bbf7-243ab8de0d39"}]}}}}]},"TypeGuid":"(Guid)6f9dac99-8de1-4efc-8465-68ac443b7d08","EmbeddedTypeGuids":{"@Type":"[Guid]","@Value":["(Guid)a9ed5b7e-75c5-4651-af16-d2c27e98cb94","(Guid)3b83b776-fb25-43b8-99f2-3c507c9143fc"]}}},"TypeInfos":{"2c41fa04":"{2c41fa04-1834-41c1-816e-303c7aa2c05b}","81297157":"{81297157-7ec9-45ce-845e-84cab2b88ade}","829a18f2":"{829a18f2-c514-4f6e-9634-1df173429203}","fa2ee218":"{fa2ee218-a39b-4b6d-b249-49dbddbd168a}","Guid":"System.Guid","string":"System.String"}},"object":{"Graph":{"@Type":"6f9dac99","@Value":{"SpecialFunc":{"@Type":"0db3d7bb:Enum","@Value":"None"},"Implementation":{"@Type":"3b83b776","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)IF IO_Link_port.vendor_ID = 310 THEN\t\t\t\t//  If it's an IFM device\n\tCASE IO_Link_port.device_ID OF\n\t\t893: output_block.AL2330_or_AL2331();\t\t//  If the device ID matches an AL2330, AL2331, or AL2230 (they use the same ID), run the code for those blocks.\n\t\t996: output_block.AL2330_or_AL2331();\t\t//  If the device is an AL2231, run the same code.   (Different ID, but functionally the same?)\n\tEND_CASE\nEND_IF\n\n\n//    WARNINGS       WARNINGS     WARNINGS\n\n\n\n// UNKNOWN SENSOR WARNING!!      This warning checks if the device ID is an unfamiliar one or if the vendor ID is not IFM's (310).\n\nunknown_device_warning (OK :=\n\t(NOT IO_Link_port.not_connected\t\t\t\t\t//  Are we completely disconnected (no device)?  If not, that's a different warning.\n\tAND ((IO_Link_port.device_ID = 893\t\t\t\t//  Is the block an AL2330/AL2331/AL2230?\n\tOR IO_Link_port.device_ID = 996)\t\t\t\t//  Or is it an AL2231?   (No idea why they made the ID different for this unit.)\n\tAND IO_Link_port.vendor_ID = 310)),\t\t\t\t//  Is the manufacturer IFM?\n\twarning_message := unknown_device_message,\t\t//  Assign the warning message to send if the warning is triggered\n\ttime_delay := 10); \t\t\t\t\t\t\t\t//  Set a 10 second time delay\n\n\n//   DEVICE DISCONNECTED WARNING!!\n//     This section checks if a sensor or device is connected.\n\ndisconnected_block_warning (OK :=\n\tNOT IO_Link_port.not_connected\n\tAND NOT IO_Link_port.data_invalid\t\t\t\t\t\t  \t\t//  if the device isn't connected or not communicating legibly,\n\tOR IO_Link_port.master_disconnected,\t\t\t\t\t\t\t//  but the master block is still connected (if the master is disconnected, don't spam the user with individual device disconnects)\n\twarning_message := disconnected_block_message,\n\ttime_delay := 10);\n\n\n//  BLOCK SHORT CIRCUIT WARNING!!\n//    This section checks if the control circuitry of the output block is shorted (drawing too much power).\n\n\nshorted_device_warning (OK :=\n\tNOT IO_Link_port.short_circuit,\n\twarning_message := shorted_device_message);\n\t\n\n//   Shorted port on output block warning (when a specific device connected to a port of the output block is drawing too much power)\n\nshorted_port_warning (OK := NOT output_port_short_circuited,\t\t//  We are OK if we haven't gotten a 'port shorted' message from the logic\n\t\twarning_message := shorted_port_message);\n\t\t\n//  Power supply problem warning, this triggers if one or both of the two +24v power supply wires is below voltage.\n//  To generate this warning, the block's control circuitry (which is powered over the IO-Link connection) must still be working/powered.\n\npower_problem_warning (OK :=\n\tNOT power_supply_problem,\t\t\t\t\t\t\t//  We are OK if the action associated with the output block hasn't reported a power loss problem.\n\twarning_message := power_supply_problem_message);\n\t\n\n//  This section sets the 'output block available' flag based on whether or not we've seen a serious problem with that device.\n//  This flag can be used by the system to decide to stop running, etc.\n\nIF NOT disconnected_block_warning.warning_sent\t\t\t\t//  If the Master block is connected to something\n\tAND NOT shorted_device_warning.warning_sent\t\t//  and we don't have a short circuit\n\tAND NOT Unknown_device_warning.warning_sent\t\t\t\t//  and we understand whatever device is connected\n\tAND NOT IO_Link_port.master_disconnected THEN\t\t\t//  and the Master block is OK, then:\n\t\tOutput_block_available := TRUE;\t\t\t\t\t\t//  Note that the output block is working and available.\n\tELSE\n\t\tOutput_block_available := FALSE;\t\t\t\t\t\t//  Or not.  :-)\nEND_IF\n\n","LineInfoPersistence":"(string)3bc25518-2022-4768-a8c7-d2d021c7a0af_Impl_LineIds"}}}},"Interface":{"@Type":"a9ed5b7e","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)//  This program provides an interface between in output block (such as the IFM AL2330) and our programs.   The easiest way to use it is generally to add it to a CFC program and drag to connect ports.\n//  These are 'high power' output blocks, capable of 1.8 amps per side (right vs left of the block.)\n\n//  This POU generates warnings for device disconnect, shorted block, shorted individual ports, and unknown device connected (to the IO-Link master)\n//  and has associated warning visus for each of these conditions.\n\n//  Currently supported devices:\n//\t\t-IFM AL2330 output block.  https://www.ifm.com/us/en/product/AL2330\t\tSix ports with two addressable pins each.  IP65, orange case.\n//\t\t-IFM AL2331 output block.  https://www.ifm.com/us/en/product/AL2331\t\tTen ports with two addressable pins each.  IP65, orange case.\n//\t\t-IFM AL2230 output block.  https://www.ifm.com/us/en/product/AL2230\t\tSix ports with two addressable pins each.  IP69, gray case.\n//\t\t-IFM AL2231 output block.  https://www.ifm.com/us/en/product/AL2231\t\tTen ports with two addressable pins each.  IP69, gray case.\n\n//  Last changed:  1/30/2024 by Nathan\n//  Tested:  \n\nPROGRAM Output_block\nVAR\n\n\toutput_word_0: WORD;\t\t//  Used to store data while combinging a bunch of BOOLs into a word to be written to the device to control individual outputs.\n\toutput_word_1: WORD;\t\t//  Used to store data while combinging a bunch of BOOLs into a word to be written to the device to control individual outputs.\n\t\n\n\t//   WARNINGS\n\n\t//  Power supply problem to output block\n\t\n\tpower_supply_problem: BOOL;\t\t\t\t//  If TRUE, something is wrong with +24v supply power to the output block (loose wire, etc.)   This logic is handled in the device-specific action because the data mapping may vary from device to device.\n\tpower_supply_problem_message: warning_message := (red := TRUE, pop_up_everywhere := TRUE, detail_warning_visu := 'W???', short_Description := 'Power loss to output block');\n\tpower_problem_warning: create_warning;\n\n\t//  Shorted port on the output block (a specific device the output block is powering is drawing too much power.)\n\n\toutput_port_short_circuited: BOOL;\t\t//  If TRUE, a device connected to one of the output ports is drawing too much power (high current.)\n\tshorted_port_description: STRING;\t\t//  This is used to store a text description of which port shorted, which is used by the HMI to describe the problem to the user.\n\n\tshorted_port_message: warning_message := (red := TRUE, pop_up_everywhere := TRUE, detail_warning_visu := 'W276', short_Description := 'Shorted output block port');\n\tshorted_port_warning: create_warning;\n\t\n\t//  Unknown output block Warning\n\n\tunknown_device_message: warning_message := (red := TRUE, pop_up_everywhere := TRUE, detail_warning_visu := 'W94', short_Description := 'Unknown output block');\n\tunknown_device_warning: create_warning;\n\n\t//  Disconnected output block warning\n\t\t\n\tdisconnected_block_message: warning_message := (red := TRUE, pop_up_everywhere := TRUE, detail_warning_visu := 'W75', short_Description := 'Output block disconnected');\n\tdisconnected_block_warning: create_warning;\n\t\n\t//  Shorted output block Warning\n\t\n\tshorted_device_message: warning_message := (red := TRUE, pop_up_everywhere := TRUE, detail_warning_visu := 'W76', short_Description := 'Output block shorted');\n\t\n\tshorted_device_warning: create_warning;\n\n\t\t\nEND_VAR\n\nVAR_INPUT\n\tx1_0_pin2 : BOOL;  \t\t// Port X1.0, pin 2, upper light (DO2)   white wire\n\tx1_0_pin4 : BOOL;  \t\t// Port X1.0, pin 4, lower light (DO1)   black wire\n\t\n\tx1_1_pin2 : BOOL;  \t\t// Port X1.1, pin 2, upper light (DO2)   white wire\n\tx1_1_pin4 : BOOL;  \t\t// Port X1.1, pin 4, lower light (DO1)   black wire\n\t\n\tx1_2_pin2 : BOOL;  \t\t// Port X1.2, pin 2, upper light (DO2)   white wire\n\tx1_2_pin4 : BOOL;  \t\t// Port X1.2, pin 4, lower light (DO1)   black wire\n\t\n\tx1_3_pin2 : BOOL;  \t\t// Port X1.3, pin 2, upper light (DO2)   white wire\n\tx1_3_pin4 : BOOL;  \t\t// Port X1.3, pin 4, lower light (DO1)   black wire\n\t\n\tx1_4_pin2 : BOOL;  \t\t// Port X1.4, pin 2, upper light (DO2)   white wire\n\tx1_4_pin4 : BOOL;  \t\t// Port X1.4, pin 4, lower light (DO1)   black wire\n\t\n\tx1_5_pin2 : BOOL;  \t\t// Port X1.5, pin 2, upper light (DO2)   white wire\n\tx1_5_pin4 : BOOL;  \t\t// Port X1.5, pin 4, lower light (DO1)   black wire\n\t\n\tx1_6_pin2 : BOOL;  \t\t// Port X1.6, pin 2, upper light (DO2)   white wire\n\tx1_6_pin4 : BOOL;  \t\t// Port X1.6, pin 4, lower light (DO1)   black wire\n\t\n\tx1_7_pin2 : BOOL;  \t\t// Port X1.7, pin 2, upper light (DO2)   white wire\n\tx1_7_pin4 : BOOL;  \t\t// Port X1.7, pin 4, lower light (DO1)   black wire\n\t\n\tx1_8_pin2 : BOOL;  \t\t// Port X1.8, pin 2, upper light (DO2)   white wire\n\tx1_8_pin4 : BOOL;  \t\t// Port X1.8, pin 4, lower light (DO1)   black wire\n\t\n\tx1_9_pin2 : BOOL;  \t\t// Port X1.9, pin 2, upper light (DO2)   white wire\n\tx1_9_pin4 : BOOL;  \t\t// Port X1.9, pin 4, lower light (DO1)   black wire\n\nEND_VAR\n\nVAR_IN_OUT\n\tIO_Link_port: IO_link_port;\t\t//  The port on the master block that the output block is connected to.\nEND_VAR\nVAR_OUTPUT\n\tOutput_block_available: BOOL;\t//  TRUE if everything is OK with the block(connected, not faulted, etc.)\nEND_VAR","LineInfoPersistence":"(string)3bc25518-2022-4768-a8c7-d2d021c7a0af_Decl_LineIds"}}}},"UniqueIdGenerator":"(string)853","POULevel":{"@Type":"8e575c5b:Enum","@Value":"Standard"},"ChildObjectGuids":{"@Type":"ArrayList:IList","@Value":[]},"AddAttributeSubsequent":"(bool)False"}},"TypeInfos":{"0db3d7bb":"{0db3d7bb-cde0-4416-9a7b-ce49a0124323}","3b83b776":"{3b83b776-fb25-43b8-99f2-3c507c9143fc}","6f9dac99":"{6f9dac99-8de1-4efc-8465-68ac443b7d08}","8e575c5b":"{8e575c5b-1d37-49c6-941b-5c0ec7874787}","a9ed5b7e":"{a9ed5b7e-75c5-4651-af16-d2c27e98cb94}","ArrayList":"System.Collections.ArrayList","bool":"System.Boolean","f3878285":"{f3878285-8e4f-490b-bb1b-9acbb7eb04db}","string":"System.String"}}},"FormatVersion":"1.0"}